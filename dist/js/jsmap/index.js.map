{"version":3,"sources":["index.js"],"names":["window","requestAnimFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","callback","setTimeout","console","log","$sliceWrap","$","$stage","init","str","i","html","$slices","find","each","index","item","css","transform","sliceWrap","stage","startRotateY","startRotateX","initTranslateZ","parseInt","anime","getValue","bodyTouchHandler","start","touch","parseFloat","moving","rotateY","diffX","rotateX","diffY","stageRotateX","currentZ","targetZ","absoluteValue","IcanHandlerIt","translateZ","moveToInitZ","bodyMoving","handler","startX","startY","$body","time","preTime","preDiffX","on","e","touches","clientX","clientY","movingX","movingY","Date","preventDefault","speed","t","moveX","moveY","v"],"mappings":"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","file":"index.js","sourcesContent":["window.requestAnimFrame = (function(){\n  return  window.requestAnimationFrame       ||\n          window.webkitRequestAnimationFrame ||\n          window.mozRequestAnimationFrame    ||\n          function( callback ){\n            window.setTimeout(callback, 1000 / 60);\n          };\n})();\n\nconsole.log(requestAnimationFrame);\n\nlet $sliceWrap = $('.slice-wrap');\nlet $stage = $('.stage');\n\n(function init() {\n    let str = '';\n    for(var i = 1; i <= 24; i++) {\n        str += `<div class=\"slice\" style=\"background-image:url(dist\\/img\\/slice/${i}.png)\"></div>`\n    }\n    $sliceWrap.html(str);\n\n\n    let $slices = $sliceWrap.find('.slice');\n\n    $slices.each((index, item) => {\n        $(item).css({\n            transform: `rotateY(${-360/24*index}deg) \n                        translateZ(-489px) \n                        translateY(460px)`\n        });\n    });\n    $sliceWrap.css({\n        transform: 'translateX(370px) translateZ(500px) translateY(-600px) rotateY(200deg)'\n    })\n}());\n\n\nlet sliceWrap = $sliceWrap[0];\nlet stage = $stage[0];\n\nlet \n    startRotateY = 0,\n    startRotateX = 0;\n\n\nlet initTranslateZ = parseInt(anime.getValue(stage, 'translateZ'));\n\nlet bodyTouchHandler = {};\n\n\nbodyTouchHandler.start = (touch) => {\n    startRotateX = parseFloat(anime.getValue(stage, 'rotateX'));\n    startRotateY = parseFloat(anime.getValue(sliceWrap, 'rotateY'));\n}\n\nbodyTouchHandler.moving = (touch) => {\n    let \n        rotateY = startRotateY - (touch.diffX / 2880 * 360),\n        rotateX = startRotateX - (touch.diffY / 2880 * 360);\n    \n\n\n    $sliceWrap.css({\n        transform: `translateX(370px) \n                    translateZ(500px) \n                    translateY(-600px) \n                    rotateY(${rotateY}deg)`\n    });\n    let stageRotateX = anime.getValue(stage, 'rotateX');\n\n    let currentZ = parseFloat(anime.getValue(stage, 'translateZ'));\n\n    let targetZ = currentZ - absoluteValue(touch.diffX);\n\n\n    let IcanHandlerIt = anime.getValue(stage, 'rotateX');\n\n    $stage.css({\n        transform: `rotateX(${IcanHandlerIt}) translateZ(${(targetZ - currentZ) * 2}px)`\n    })\n\n\n    // anime({\n    //     targets: stage,\n    //     rotateX: stageRotateX,\n    //     translateZ: (element, index) => {\n    //         // console.log(touch.speed * 100);\n    //         return initTranslateZ - Math.log(touch.speed * 1000000) * 100;\n    //     }\n    // });\n    // setTimeout(() => {\n    //    anime({\n    //        targets: stage,\n    //        rotateX: () => {\n    //            return anime.getValue(stage, 'rotateX');\n    //        },\n    //        translateZ: (element, index) => {\n    //            return initTranslateZ;\n    //        }\n    //    }); \n    // }, 100)\n\n    if(rotateX > 40 || rotateX < -40) return;\n    let translateZ = anime.getValue(stage, 'translateZ');\n    $stage.css({\n        transform: `rotateX(${rotateX}deg) translateZ(${(targetZ - currentZ) * 2}px)`\n    });\n\n}\n\n\n(function moveToInitZ() {\n    \n    requestAnimationFrame(moveToInitZ);\n    let currentZ = parseInt(anime.getValue(stage, 'translateZ'));\n    let rotateX = anime.getValue(stage, 'rotateX');\n\n    if(currentZ < 0) {\n        currentZ /= 2;\n        $stage.css({\n            transform: `rotateX(${rotateX}) translateZ(${currentZ}px)`,\n        })\n    }\n})()\n\nbodyMoving(bodyTouchHandler);\n\nfunction bodyMoving(handler) {\n    let startX = 0;\n    let startY = 0;\n\n\n    let $body = $('body');\n\n    let time = 0;\n    let preTime = 0;\n\n\n    let preDiffX = 0;\n\n    $body.on('touchstart', (e) => {\n        let touch = e.touches[0];\n\n        startX = touch.clientX;\n        startY = touch.clientY;\n\n        // console.log(startX);\n\n        touch.movingX = touch.clientX;\n        touch.movingY = touch.clientY;\n\n\n        touch.startX = startX;\n        touch.startY = startY;\n        handler.start(touch);\n\n\n        preTime = new Date();\n    });\n\n    $body.on('touchmove', (e) => {\n        e.preventDefault();\n\n        time = new Date();\n\n        let speed = 0,\n            t = time - preTime;\n        preTime = time;\n\n\n\n        let \n            touch = e.touches[0],\n            moveX = touch.clientX,\n            moveY = touch.clientY,\n\n\n            diffX = moveX - startX,\n            diffY = moveY - startY;\n\n        touch.moveX = moveX;\n        touch.moveY = moveY;\n\n        touch.diffX = diffX;\n        touch.diffY = diffY;\n\n\n        speed = absoluteValue(touch.diffX - preDiffX) / t ;\n\n        preDiffX = touch.diffX;\n        touch.speed = speed;\n        handler.moving(touch);\n\n    });\n    $body.on('touchend', (e) => {\n        let touch = e.touches[0];\n\n    })\n}\n\nfunction absoluteValue(v) {\n   return v < 0 ? -v : v; \n}\n\n\n\n"],"sourceRoot":"/source/"}